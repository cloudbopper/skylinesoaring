{% block content %}

{% load static %}
{% load crispy_forms_tags %}


<div class="modal-header">
  <h5 class="modal-title">
    {% if form.instance.pk %}Edit Flight{% else %}Add Flight{% endif %}
  </h5>
  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
</div>

<form method="post" enctype="multipart/form-data" id="edit-flight-form">
  <div class="modal-body">
    {% csrf_token %}
    <table class="table table-borderless align-middle">
      <tbody>
        <tr>
          <th scope="row">Pilot</th>
          <td>{{ form.pilot|as_crispy_field }}</td>
        </tr>
        <tr>
          <th scope="row">Instructor</th>
          <td>{{ form.instructor|as_crispy_field }}</td>
        </tr>
        <tr>
          <th scope="row">Glider</th>
          <td>{{ form.glider|as_crispy_field }}</td>
        </tr>
        <tr>
          <th scope="row">Towpilot</th>
          <td>{{ form.tow_pilot|as_crispy_field }}</td>
        </tr>
        <tr>
          <th scope="row">Towplane</th>
          <td>{{ form.towplane|as_crispy_field }}</td>
        </tr>
        <tr>
          <th scope="row">Launch Time</th>
          <td>{{ form.launch_time|as_crispy_field }}</td>
        </tr>
        <tr>
          <th scope="row">Landing Time</th>
          <td>{{ form.landing_time|as_crispy_field }}</td>
        </tr>
        <tr>
          <th scope="row">Release Altitude</th>
          <td>{{ form.release_altitude|as_crispy_field }}</td>
        </tr>
      </tbody>
    </table>

  </div>

  <div class="modal-footer">
    <button type="submit" class="btn btn-primary">
      {% if form.instance.pk %}Save Changes{% else %}Add Flight{% endif %}
    </button>
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
  </div>
</form>


<script>
  document.getElementById("edit-flight-form").addEventListener("submit", function (e) {
    e.preventDefault();
    const form = e.target;
    const url = form.action || window.location.href;
    const data = new FormData(form);

    fetch(url, {
      method: "POST",
      headers: { "X-Requested-With": "XMLHttpRequest" },
      body: data
    })
    .then(response => {
      if (!response.ok) throw new Error("Failed to save");
      return response.json();
    })
    .then(data => {
      if (data.success) {
        location.reload();
      }
    })
    .catch(error => {
      alert("Could not save the flight. Please try again.");
    })
  });
</script>

  <footer style="font-size: 0.8em; color: gray;">
    Template: <code>logsheet/edit_flight_form.html</code>
  </footer>
{% endblock %}