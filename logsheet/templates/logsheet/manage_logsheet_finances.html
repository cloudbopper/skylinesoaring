{% extends "base.html" %}
{% load humanize %}

{% block content %}
{% load member_extras %}

<h2>Finances for {{ logsheet.log_date }} @ {{ logsheet.airfield }}</h2>

<h4 class="mt-5">Summary by Pilot</h4>

<table class="table table-striped table-sm">
  <thead>
    <tr>
      <th>Pilot</th>
      <th># Flights</th>
      <th class="text-end">Tow Total</th>
      <th class="text-end">Rental Total</th>
      <th class="text-end">Grand Total</th>
    </tr>
  </thead>
  <tbody>
    {% for pilot, summary in pilot_summary.items %}
    <tr>
      <td>{{ pilot|full_display_name }}</td>
      <td>{{ summary.count }}</td>
      <td class="text-end">${{ summary.tow|floatformat:2 }}</td>
      <td class="text-end">${{ summary.rental|floatformat:2 }}</td>
      <td class="text-end fw-bold">${{ summary.total|floatformat:2 }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<h4 class="mt-5">Member Charges</h4>
<p class="text-muted">This reflects who is financially responsible for each flight, including splits.</p>

<table class="table table-sm table-striped">
  <thead>
    <tr>
      <th>Member</th>
      <th class="text-end">Tow</th>
      <th class="text-end">Rental</th>
      <th class="text-end">Total</th>
    </tr>
  </thead>
  <tbody>
    {% for member, summary in member_charges.items %}
    <tr>
      <td>{{ member|full_display_name }}</td>
      <td class="text-end">${{ summary.tow|floatformat:2 }}</td>
      <td class="text-end">${{ summary.rental|floatformat:2 }}</td>
      <td class="text-end fw-bold">${{ summary.total|floatformat:2 }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<h4 class="mt-5">Summary by Flight</h4>
<table class="table table-bordered table-sm align-middle">
  <thead>
    <tr>
      <th>Pilot</th>
      <th>Glider</th>
      <th>Duration</th>
      <th class="text-end">Tow Cost</th>
      <th class="text-end">Rental Cost</th>
      <th class="text-end">Total</th>
    </tr>
  </thead>
  <tbody>
    {% for flight, costs in flight_data %}
      <tr>
        <td>{{ flight.pilot|full_display_name }}</td>
        <td>{{ flight.glider }}</td>
        <td>{{ flight.duration }}</td>
        <td class="text-end">${{ costs.tow|floatformat:2 }}</td>
        <td class="text-end">${{ costs.rental|floatformat:2 }}</td>
        <td class="text-end fw-bold">${{ costs.total|floatformat:2 }}</td>
      </tr>
    {% endfor %}
  </tbody>
  <tfoot>
    <tr class="table-light">
      <th colspan="3" class="text-end">Totals:</th>
      <th class="text-end">${{ total_tow|floatformat:2 }}</th>
      <th class="text-end">${{ total_rental|floatformat:2 }}</th>
      <th class="text-end">${{ total_sum|floatformat:2 }}</th>
    </tr>
  </tfoot>
</table>

<a href="{% url 'logsheet:manage' pk=logsheet.pk %}" class="btn btn-secondary">Back to Flight Log</a>
{% endblock %}
